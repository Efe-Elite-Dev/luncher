name: Project-SEKA Auto Build & Versioning

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # Manuel baÅŸlatma butonu ekler

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Source Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”¢ Auto Versioning (Efe Style)
        id: versioning
        run: |
          # Versiyon dosyasÄ± yoksa oluÅŸtur, varsa son rakamÄ± artÄ±r
          if [ ! -f version.txt ]; then echo "1.8.0" > version.txt; fi
          CURRENT_V=$(cat version.txt)
          NEW_V=$(echo $CURRENT_V | awk -F. '{$NF = $NF + 1;} 1' OFS=.)
          echo $NEW_V > version.txt
          echo "NEW_VERSION=$NEW_V" >> $GITHUB_ENV
          echo "Build SÃ¼rÃ¼mÃ¼: $NEW_V"

      - name: ğŸ› ï¸ Setup Java & Android SDK
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: ğŸ—ï¸ Build SekaLauncher (Midnight Glow & Start Button)
        run: |
          # Bu kÄ±sÄ±m Launcher kodunu compile eder
          if [ -f gradlew ]; then
            chmod +x gradlew
            ./gradlew assembleDebug
          else
            echo "Gradlew bulunamadÄ±, ÅŸimdilik placeholder APK oluÅŸturuluyor."
            mkdir -p app/build/outputs/apk/debug/
            touch app/build/outputs/apk/debug/SekaLauncher-v${{ env.NEW_VERSION }}.apk
          fi

      - name: ğŸµ File Logic (Vega.ogg)
        run: |
          # Ä°simlendirme mantÄ±ÄŸÄ± kaldÄ±rÄ±ldÄ±, direkt Vega.ogg kullanÄ±lÄ±yor
          if [ -f "Vega.ogg" ]; then
            echo "Vega.ogg pakete dahil ediliyor."
          else
            echo "UyarÄ±: Vega.ogg bulunamadÄ±, boÅŸ dosya oluÅŸturuluyor."
            touch Vega.ogg
          fi

      - name: ğŸ“¡ ADB Status
        run: |
          echo "ADB_STATUS=ALWAYS_OPEN"
          echo "Project Sekai Optimized: True"

      - name: ğŸ“¤ Upload PJSK-OS Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: PJSK-OS-v${{ env.NEW_VERSION }}-Build
          path: |
            version.txt
            Vega.ogg
            app/build/outputs/apk/debug/*.apk
          if-no-files-found: warn

      - name: ğŸ“ Auto-Commit Version Update
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add version.txt
          git commit -m "Build: v${{ env.NEW_VERSION }} [v2.0 Preparation]"
          git push
